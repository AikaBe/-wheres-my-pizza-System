üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –≤—Å—ë —Å–≤—è–∑–∞–Ω–æ)

–ö–ª–∏–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, curl) ‚Üí Order Service

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP POST /orders —Å –∑–∞–∫–∞–∑–æ–º.

Order Service:

–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ,

—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –≤ PostgreSQL (orders, order_items, order_status_log),

–ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º –∑–∞–∫–∞–∑–µ –≤ RabbitMQ (exchange orders_topic).

RabbitMQ ‚Üí Kitchen Worker

RabbitMQ –∫–ª–∞–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, kitchen.takeout.1).

Kitchen Worker –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —ç—Ç—É –æ—á–µ—Ä–µ–¥—å.

–û–Ω –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –∑–∞–∫–∞–∑, –æ—Ç–º–µ—á–∞–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å cooking –≤ –±–∞–∑–µ, —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–∫—É (sleep 10 —Å–µ–∫), –ø–æ—Ç–æ–º —Å—Ç–∞–≤–∏—Ç ready.

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:

–ø–∏—à–µ—Ç –ª–æ–≥ –≤ —Ç–∞–±–ª–∏—Ü—É order_status_log,

–ø—É–±–ª–∏–∫—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ RabbitMQ (notifications_fanout).

RabbitMQ ‚Üí Notification Subscriber

Notification Subscriber –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ notifications_fanout.

–ö–∞–∂–¥—ã–π –∞–ø–¥–µ–π—Ç –∑–∞–∫–∞–∑–∞ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—á–∞—Ç–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å, –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å: —Å–ª–∞—Ç—å email, –ø—É—à-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

Tracking Service

–ù–µ —Å–ª—É—à–∞–µ—Ç RabbitMQ.

–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "read-only API".

–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ ‚Äî –æ–Ω —à–ª—ë—Ç HTTP GET –Ω–∞ /orders/{order_number}/status.

Tracking Service –¥–µ–ª–∞–µ—Ç SELECT –≤ PostgreSQL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

üìå –ü–æ–ª—É—á–∞–µ—Ç—Å—è:

Order Service = –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ (API) + –∑–∞–ø–∏—Å—å –≤ –ë–î + –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è.

Kitchen Worker = –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–∫–∞–∑–æ–≤ (—á–∏—Ç–∞–µ—Ç –∏–∑ RabbitMQ, –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î).

Notification Service = —Å–ª—É—à–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (fanout ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).

Tracking Service = —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –∏–∑ –ë–î –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

üì® –ó–∞—á–µ–º RabbitMQ?

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å
–ï—Å–ª–∏ –∫—É—Ö–Ω—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞ ‚Äî Order Service –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã. –û–Ω –Ω–µ –∂–¥—ë—Ç, –ø–æ–∫–∞ –∫—É—Ö–Ω—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è.
‚Üí RabbitMQ —Ö—Ä–∞–Ω–∏—Ç –∑–∞–∫–∞–∑—ã –≤ –æ—á–µ—Ä–µ–¥–∏.

–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
–ï—Å–ª–∏ Kitchen Worker —É–ø–∞–ª ‚Äî –∑–∞–∫–∞–∑ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è, –æ–Ω –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏.

–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
–ú–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Kitchen Workers (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5), –æ–Ω–∏ –±—É–¥—É—Ç –¥–µ–ª–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑—ã.

–ì–∏–±–∫–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

Work Queue (–æ–¥–∏–Ω –∑–∞–∫–∞–∑ ‚Üí –æ–¥–∏–Ω –ø–æ–≤–∞—Ä).

Fanout (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏).

Routing (—Ä–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–∫–∞–∑–æ–≤: delivery, dine-in).

üßµ –ó–∞—á–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã?

–ì–æ—Ä—É—Ç–∏–Ω—ã –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã:

Order Service –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–ª –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –∏ –ø—É–±–ª–∏–∫–æ–≤–∞–ª –∏—Ö –≤ RabbitMQ (–∫–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Å–≤–æ–µ–π –≥–æ—Ä—É—Ç–∏–Ω–µ).

Kitchen Worker –º–æ–≥ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

—Å–ª—É—à–∞—Ç—å –æ—á–µ—Ä–µ–¥—å,

–æ–±–Ω–æ–≤–ª—è—Ç—å –ë–î,

—Å–ª–∞—Ç—å heartbeat,

—Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤–∫—É (sleep), –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –≤–æ—Ä–∫–µ—Ä—ã.

Notification Subscriber –º–æ–≥ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ –ø–µ—á–∞—Ç–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

‚ö°Ô∏è –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å –ø–æ—Ç–æ–∫–∞–º–∏
–ö–ª–∏–µ–Ω—Ç ‚Üí (HTTP POST /orders) ‚Üí Order Service
‚Ü≥ PostgreSQL (insert order)
‚Ü≥ RabbitMQ (publish "new order")

RabbitMQ ‚Üí Kitchen Worker
‚Ü≥ PostgreSQL (update status = cooking, –ø–æ—Ç–æ–º ready)
‚Ü≥ RabbitMQ (publish "status update")

RabbitMQ ‚Üí Notification Subscriber
‚Ü≥ –ö–æ–Ω—Å–æ–ª—å/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ("Order 123 is ready")

–ö–ª–∏–µ–Ω—Ç ‚Üí (HTTP GET /orders/123/status) ‚Üí Tracking Service
‚Ü≥ PostgreSQL (select status)
‚Ü≥ JSON response
